<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Submit a Review — Supabase</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light dark" />
</head>

<body class="bg-gray-50 dark:bg-[#050814] min-h-screen text-gray-900 dark:text-gray-100">

  <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-12 space-y-10">

    <!-- HEADER -->
    <section class="bg-white dark:bg-[#0f1622] border border-gray-200/70 dark:border-[#1f2a3a] rounded-2xl p-6 sm:p-8 shadow-sm">
      <p class="text-xs font-semibold tracking-[0.25em] uppercase text-emerald-500 mb-2">
        Supabase · Postgres Review DB
      </p>
      <h1 class="text-2xl sm:text-3xl font-semibold tracking-tight mb-3">
        Submit a Review (Supabase)
      </h1>
      <p class="text-sm sm:text-base text-gray-600 dark:text-gray-300 max-w-3xl">
        This form writes directly to a <span class="font-semibold">PostgreSQL</span> database hosted on
        <span class="font-semibold">Supabase</span>. Each review links a customer, an item, and a star rating.
      </p>
      <p class="mt-3 text-xs text-gray-500 dark:text-gray-400">
        In this demo, items are managed separately in the <code class="font-mono text-emerald-500">items</code> table.
        You’ll select them here by <span class="font-semibold">item_id</span>.
      </p>
    </section>

    <!-- FORM -->
    <section class="bg-white dark:bg-[#0f1622] border border-gray-200/70 dark:border-[#1f2a3a] rounded-2xl p-6 sm:p-8 shadow-sm">
      <form id="supabaseReviewForm" class="grid grid-cols-1 sm:grid-cols-2 gap-5" novalidate>
        <!-- First name -->
        <div>
          <label for="firstName" class="block text-sm font-medium mb-1">First name</label>
          <input
            id="firstName"
            name="firstName"
            type="text"
            required
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950] bg-white dark:bg-[#0f1622] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500"
          />
        </div>

        <!-- Last name -->
        <div>
          <label for="lastName" class="block text-sm font-medium mb-1">Last name</label>
          <input
            id="lastName"
            name="lastName"
            type="text"
            required
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950] bg-white dark:bg-[#0f1622] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500"
          />
        </div>

        <!-- Email -->
        <div>
          <label for="email" class="block text-sm font-medium mb-1">Email</label>
          <input
            id="email"
            name="email"
            type="email"
            inputmode="email"
            autocomplete="email"
            required
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950] bg-white dark:bg-[#0f1622] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500"
          />
        </div>

        <!-- Item (select from items table) -->
        <div>
          <label for="itemId" class="block text-sm font-medium mb-1">
            Item <span class="text-xs text-gray-500">(from items table)</span>
          </label>
          <select
            id="itemId"
            name="itemId"
            required
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950] bg-white dark:bg-[#0f1622] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500"
          >
            <option value="">Loading items…</option>
          </select>
          <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
            Options are loaded live from the <code class="font-mono">items</code> table in Supabase.
          </p>
        </div>

        <!-- Rating -->
        <div>
          <label for="rating" class="block text-sm font-medium mb-1">Star rating (1–5)</label>
          <select
            id="rating"
            name="rating"
            required
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950] bg-white dark:bg-[#0f1622] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500"
          >
            <option value="">Choose…</option>
            <option value="5">5 — Excellent</option>
            <option value="4">4 — Good</option>
            <option value="3">3 — Okay</option>
            <option value="2">2 — Poor</option>
            <option value="1">1 — Bad</option>
          </select>
        </div>

        <!-- Review text -->
        <div class="sm:col-span-2">
          <label for="reviewText" class="block text-sm font-medium mb-1">Review text (optional)</label>
          <textarea
            id="reviewText"
            name="reviewText"
            rows="4"
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950] bg-white dark:bg-[#0f1622] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-500"
          ></textarea>
        </div>

        <!-- Actions + status -->
        <div class="sm:col-span-2 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
          <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3">
            <button
              id="submitBtn"
              type="submit"
              class="inline-flex items-center justify-center px-5 py-2.5 rounded-lg bg-emerald-600 hover:bg-emerald-700 text-white font-medium shadow disabled:opacity-60 disabled:cursor-not-allowed"
            >
              Submit Review to Supabase
            </button>

            <!-- NEW: link to Supabase How It Works page -->
            <a
              href="/pages/hiw/superbase.html"
              class="text-xs sm:text-sm underline text-gray-600 dark:text-gray-300 hover:text-emerald-500 dark:hover:text-emerald-400"
            >
              See how this Supabase setup works →
            </a>
          </div>

          <p id="status" class="text-xs sm:text-sm text-gray-600 dark:text-gray-300"></p>
        </div>
      </form>

      <p class="mt-4 text-xs text-gray-500 dark:text-gray-400">
        Behind the scenes, this form:
        <span class="font-semibold">upserts</span> the customer by email into
        <code class="font-mono text-emerald-500">customers</code>, then inserts a row into
        <code class="font-mono text-emerald-500">reviews</code> with foreign keys.
      </p>
    </section>

    <!-- LIVE SUMMARIES FROM VIEWS -->
    <section class="bg-white dark:bg-[#0f1622] border border-gray-200/70 dark:border-[#1f2a3a] rounded-2xl p-6 sm:p-8 shadow-sm space-y-6">
      <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
        <div>
          <p class="text-xs font-semibold tracking-[0.25em] uppercase text-emerald-500 mb-1">
            Live Supabase Summaries
          </p>
          <h2 class="text-xl sm:text-2xl font-semibold tracking-tight">
            Views: Item &amp; Customer Review Stats
          </h2>
          <p class="text-sm text-gray-600 dark:text-gray-300 max-w-2xl">
            These tables read directly from the Postgres <code class="font-mono text-emerald-500">v_item_review_summary</code>
            and <code class="font-mono text-emerald-500">v_customer_review_summary</code> views. Every new review updates
            these automatically.
          </p>
        </div>
        <button
          id="refreshSummariesBtn"
          class="inline-flex items-center justify-center px-4 py-2 rounded-lg border border-gray-300 dark:border-[#2a3950] text-xs sm:text-sm font-medium hover:bg-gray-50 dark:hover:bg-[#111827]"
        >
          Refresh summaries
        </button>
      </div>

      <!-- Two-column layout -->
      <div class="grid gap-6 lg:grid-cols-2">
        <!-- Item summary -->
        <div class="border border-gray-200/70 dark:border-[#273248] rounded-xl overflow-hidden">
          <div class="px-4 py-3 bg-gray-100 dark:bg-[#0b1220] flex items-center justify-between">
            <div>
              <h3 class="text-sm font-semibold">Item Review Summary</h3>
              <p class="text-xs text-gray-500 dark:text-gray-400">
                From <code class="font-mono text-emerald-400">v_item_review_summary</code>
              </p>
            </div>
            <span class="text-[10px] px-2 py-1 rounded-full bg-emerald-500/10 text-emerald-400 border border-emerald-500/40">
              Products
            </span>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full text-xs sm:text-sm">
              <thead class="bg-gray-50 dark:bg-[#0f172a] text-gray-600 dark:text-gray-300">
                <tr>
                  <th class="px-3 py-2 text-left">Item</th>
                  <th class="px-3 py-2 text-right">Avg Rating</th>
                  <th class="px-3 py-2 text-right">Reviews</th>
                  <th class="px-3 py-2 text-left hidden sm:table-cell">First / Last</th>
                </tr>
              </thead>
              <tbody id="itemSummaryBody" class="divide-y divide-gray-200/70 dark:divide-[#1f2a3a]">
                <tr>
                  <td colspan="4" class="px-3 py-3 text-xs text-gray-500 dark:text-gray-400">
                    Loading item summary…
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <p id="itemSummaryStatus" class="px-4 py-2 text-[11px] text-gray-500 dark:text-gray-400"></p>
        </div>

        <!-- Customer summary -->
        <div class="border border-gray-200/70 dark:border-[#273248] rounded-xl overflow-hidden">
          <div class="px-4 py-3 bg-gray-100 dark:bg-[#0b1220] flex items-center justify-between">
            <div>
              <h3 class="text-sm font-semibold">Customer Review Summary</h3>
              <p class="text-xs text-gray-500 dark:text-gray-400">
                From <code class="font-mono text-emerald-400">v_customer_review_summary</code>
              </p>
            </div>
            <span class="text-[10px] px-2 py-1 rounded-full bg-sky-500/10 text-sky-400 border border-sky-500/40">
              Customers
            </span>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full text-xs sm:text-sm">
              <thead class="bg-gray-50 dark:bg-[#0f172a] text-gray-600 dark:text-gray-300">
                <tr>
                  <th class="px-3 py-2 text-left">Customer</th>
                  <th class="px-3 py-2 text-right">Reviews</th>
                </tr>
              </thead>
              <tbody id="customerSummaryBody" class="divide-y divide-gray-200/70 dark:divide-[#1f2a3a]">
                <tr>
                  <td colspan="2" class="px-3 py-3 text-xs text-gray-500 dark:text-gray-400">
                    Loading customer summary…
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <p id="customerSummaryStatus" class="px-4 py-2 text-[11px] text-gray-500 dark:text-gray-400"></p>
        </div>
      </div>
    </section>
  </main>

  <!-- NAV + FOOTER -->
  <script type="module">
    import { loadNav } from "../../js/pageInserts/nav.js";
    import { loadFooter } from "../../js/pageInserts/footer.js";
    loadNav();
    loadFooter();
  </script>

  <!-- Supabase form logic -->
  <script type="module" src="../../js/pages/forms/f_superbase/index.js"></script>
</body>
</html>
