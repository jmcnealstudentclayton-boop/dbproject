<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Submit a Review → Google Sheets (Make) + Live Reviews</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="light dark">
  <style>
    .star { display: inline-block; width: 1.1rem; height: 1.1rem; }
    .truncate-2 { display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
    .truncate-3 { display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; }
  </style>
</head>

<body class="bg-gray-50 dark:bg-[#0b0f14] min-h-screen text-gray-900 dark:text-gray-100">
  <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-12 space-y-10">

    <!-- ============================= -->
    <!--         HEADER / INTRO        -->
    <!-- ============================= -->
    <section class="bg-white dark:bg-[#0f1622] shadow-sm border border-gray-200/60 dark:border-[#1f2a3a] rounded-2xl p-6 sm:p-8">
      <div class="flex flex-col lg:flex-row gap-6 lg:gap-10 items-start">
        <div class="lg:w-7/12 space-y-3">
          <p class="text-xs font-semibold tracking-[0.25em] uppercase text-emerald-500">
            Google Sheets · Make · JSONBin
          </p>
          <h1 class="text-2xl sm:text-3xl font-semibold tracking-tight">
            Submit a Review (Google Sheets Backend)
          </h1>
          <p class="text-sm sm:text-base text-gray-600 dark:text-gray-300">
            This form sends data to a <span class="font-semibold">Make</span> webhook, which writes rows to
            <span class="font-semibold">Google Sheets</span> and publishes review summaries as JSON to
            <span class="font-semibold">JSONBin</span> for the website to read.
          </p>
          <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">
            Below, you can submit a review and then scroll down to see live ratings and reviewer stats
            powered entirely by the Sheets + Make automation.
          </p>
        </div>

        <div class="lg:w-5/12 flex flex-col items-start gap-3">
          <a
            href="#reviewsSection"
            class="inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-gray-300 dark:border-[#2a3950]
                   hover:bg-gray-50 dark:hover:bg-[#122033] text-sm sm:text-base"
          >
            <span>Jump to Live Reviews</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </a>

          <a
            href="/pages/hiw/googlesheet.html"
            class="text-xs sm:text-sm underline text-gray-600 dark:text-gray-300 hover:text-emerald-500 dark:hover:text-emerald-400"
          >
            See how this Google Sheets setup works →
          </a>
        </div>
      </div>
    </section>

    <!-- ============================= -->
    <!--           SUBMIT FORM         -->
    <!-- ============================= -->
    <section class="bg-white dark:bg-[#0f1622] shadow-sm border border-gray-200/60 dark:border-[#1f2a3a] rounded-2xl p-6 sm:p-8">
      <div class="flex items-center justify-between gap-4 mb-6">
        <div>
          <p class="text-xs font-semibold tracking-[0.25em] uppercase text-emerald-500 mb-1">
            Review Form
          </p>
          <h2 class="text-xl sm:text-2xl font-semibold tracking-tight">
            Leave a Product Review
          </h2>
          <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">
            Field names and IDs are aligned with the Make scenario so data lands correctly in Google Sheets.
          </p>
        </div>

        <a
          href="#reviewsSection"
          class="hidden sm:inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-gray-300 dark:border-[#2a3950]
                 hover:bg-gray-50 dark:hover:bg-[#122033] text-xs sm:text-sm"
        >
          <span>View Live Stats</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </a>
      </div>

      <!-- Keep existing IDs/names so Make + JS stay happy -->
      <form id="reviewForm" class="grid grid-cols-1 sm:grid-cols-2 gap-5" novalidate>
        <div class="sm:col-span-1">
          <label for="firstName" class="block text-sm font-medium mb-1">First name</label>
          <input
            id="firstName"
            name="firstName"
            type="text"
            required
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950]
                   bg-white dark:bg-[#0f1622] px-3 py-2
                   focus:outline-none focus:ring-2 focus:ring-emerald-500"
          />
        </div>

        <div class="sm:col-span-1">
          <label for="lastName" class="block text-sm font-medium mb-1">Last name</label>
          <input
            id="lastName"
            name="lastName"
            type="text"
            required
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950]
                   bg-white dark:bg-[#0f1622] px-3 py-2
                   focus:outline-none focus:ring-2 focus:ring-emerald-500"
          />
        </div>

        <div class="sm:col-span-1">
          <label for="email" class="block text-sm font-medium mb-1">Email</label>
          <input
            id="email"
            name="email"
            type="email"
            inputmode="email"
            autocomplete="email"
            required
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950]
                   bg-white dark:bg-[#0f1622] px-3 py-2
                   focus:outline-none focus:ring-2 focus:ring-emerald-500"
          />
        </div>

        <div class="sm:col-span-1">
          <label for="item" class="block text-sm font-medium mb-1">
            Item (SKU or Product)
          </label>
          <input
            id="item"
            name="item"
            type="text"
            placeholder="e.g., KK-1013"
            required
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950]
                   bg-white dark:bg-[#0f1622] px-3 py-2
                   focus:outline-none focus:ring-2 focus:ring-emerald-500"
          />
        </div>

        <div class="sm:col-span-1">
          <label for="rating" class="block text-sm font-medium mb-1">Rating (1–5)</label>
          <select
            id="rating"
            name="rating"
            required
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950]
                   bg-white dark:bg-[#0f1622] px-3 py-2
                   focus:outline-none focus:ring-2 focus:ring-emerald-500"
          >
            <option value="">Choose…</option>
            <option>5</option>
            <option>4</option>
            <option>3</option>
            <option>2</option>
            <option>1</option>
          </select>
        </div>

        <div class="sm:col-span-1">
          <label for="quality" class="block text-sm font-medium mb-1">Quality (1–5)</label>
          <select
            id="quality"
            name="quality"
            required
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950]
                   bg-white dark:bg-[#0f1622] px-3 py-2
                   focus:outline-none focus:ring-2 focus:ring-emerald-500"
          >
            <option value="">Choose…</option>
            <option>5</option>
            <option>4</option>
            <option>3</option>
            <option>2</option>
            <option>1</option>
          </select>
        </div>

        <div class="sm:col-span-2">
          <label for="reviewHeadline" class="block text-sm font-medium mb-1">Review headline</label>
          <input
            id="reviewHeadline"
            name="reviewHeadline"
            type="text"
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950]
                   bg-white dark:bg-[#0f1622] px-3 py-2
                   focus:outline-none focus:ring-2 focus:ring-emerald-500"
          />
        </div>

        <div class="sm:col-span-2">
          <label for="reviewText" class="block text-sm font-medium mb-1">Review text</label>
          <textarea
            id="reviewText"
            name="reviewText"
            rows="4"
            class="w-full rounded-lg border border-gray-300 dark:border-[#2a3950]
                   bg-white dark:bg-[#0f1622] px-3 py-2
                   focus:outline-none focus:ring-2 focus:ring-emerald-500"
          ></textarea>
        </div>

        <div class="sm:col-span-2 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
          <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3">
            <button
              id="submitBtn"
              type="submit"
              class="inline-flex items-center justify-center px-5 py-2.5 rounded-lg
                     bg-emerald-600 hover:bg-emerald-700 text-white font-medium shadow
                     disabled:opacity-60 disabled:cursor-not-allowed"
            >
              Submit Review
            </button>

            <a
              href="#reviewsSection"
              class="text-xs sm:text-sm underline text-gray-600 dark:text-gray-300 hover:text-emerald-500 dark:hover:text-emerald-400"
            >
              Jump to Live Reviews
            </a>
          </div>

          <p id="toast" class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 hidden"></p>
        </div>
      </form>

      <p class="mt-4 text-xs text-gray-500 dark:text-gray-400">
        Behind the scenes, this form hits a Make webhook that:
        writes rows into Google Sheets, updates a “Ratings by Product” summary, and then pushes a JSON
        payload to JSONBin for the tables below.
      </p>
    </section>

    <!-- ============================= -->
    <!--      LIVE REVIEW SUMMARY      -->
    <!-- ============================= -->
    <section
      id="reviewsSection"
      class="bg-white dark:bg-[#0f1622] shadow-sm border border-gray-200/60 dark:border-[#1f2a3a] rounded-2xl p-6 sm:p-8 space-y-8"
    >
      <!-- Ratings by Product -->
      <div>
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4">
          <div>
            <p class="text-xs font-semibold tracking-[0.25em] uppercase text-emerald-500 mb-1">
              Live Data from JSONBin
            </p>
            <h2 class="text-xl sm:text-2xl font-semibold tracking-tight">
              Ratings by Product
            </h2>
            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">
              This table is loaded from the JSON summary generated by the Google Sheets + Make workflow.
            </p>
          </div>

          <div class="flex flex-wrap items-center gap-3 text-xs sm:text-sm">
            <div class="flex items-center gap-2">
              <label for="sortSelect" class="whitespace-nowrap">Sort by</label>
              <select
                id="sortSelect"
                class="bg-gray-50 dark:bg-[#050814] border border-gray-300 dark:border-gray-700 rounded-lg px-2 py-1 text-xs sm:text-sm"
              >
                <option value="avg_desc">Average ↓</option>
                <option value="avg_asc">Average ↑</option>
                <option value="count_desc">Count ↓</option>
                <option value="count_asc">Count ↑</option>
                <option value="pid_asc">Product ↑</option>
                <option value="pid_desc">Product ↓</option>
              </select>
            </div>

            <div class="flex items-center gap-2">
              <label for="minCount" class="whitespace-nowrap">Min reviews</label>
              <input
                id="minCount"
                type="number"
                value="0"
                min="0"
                class="w-20 bg-gray-50 dark:bg-[#050814] border border-gray-300 dark:border-gray-700 rounded-lg px-2 py-1 text-xs sm:text-sm"
              />
            </div>

            <button
              id="refreshBtn"
              class="bg-emerald-600 hover:bg-emerald-700 px-3 py-1.5 rounded-lg text-xs sm:text-sm text-white font-medium"
            >
              Refresh
            </button>
          </div>
        </div>

        <div class="overflow-x-auto border border-gray-200/70 dark:border-gray-700 rounded-xl">
          <table class="min-w-full text-xs sm:text-sm">
            <thead class="bg-gray-100 dark:bg-[#0b1220] text-gray-700 dark:text-gray-300">
              <tr>
                <th class="px-4 py-2 text-left">Product</th>
                <th class="px-4 py-2 text-left">Avg Rating</th>
                <th class="px-4 py-2 text-left">Count</th>
                <th class="px-4 py-2 text-left">Recent Reviews</th>
              </tr>
            </thead>
            <tbody id="tbody" class="divide-y divide-gray-200/70 dark:divide-gray-700"></tbody>
          </table>
        </div>

        <p id="errors" class="hidden mt-3 text-xs sm:text-sm text-red-500"></p>
      </div>

      <!-- Reviewer Summary -->
      <div class="border-t border-gray-200/60 dark:border-gray-800 pt-6">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4">
          <div>
            <h3 class="text-lg sm:text-xl font-semibold">
              Reviewer Summary
            </h3>
            <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">
              Aggregated by reviewer: how many reviews they’ve left, their average rating, and how many products they’ve covered.
            </p>
          </div>

          <div class="flex flex-wrap items-center gap-3 text-xs sm:text-sm">
            <div class="flex items-center gap-2">
              <label for="userSort" class="whitespace-nowrap">Sort by</label>
              <select
                id="userSort"
                class="bg-gray-50 dark:bg-[#050814] border border-gray-300 dark:border-gray-700 rounded-lg px-2 py-1 text-xs sm:text-sm"
              >
                <option value="reviews_desc">Reviews ↓</option>
                <option value="reviews_asc">Reviews ↑</option>
                <option value="avg_desc">Avg Rating ↓</option>
                <option value="avg_asc">Avg Rating ↑</option>
                <option value="name_asc">Name A → Z</option>
                <option value="name_desc">Name Z → A</option>
              </select>
            </div>

            <div class="flex items-center gap-2">
              <label for="userMinReviews" class="whitespace-nowrap">Min reviews</label>
              <input
                id="userMinReviews"
                type="number"
                value="1"
                min="1"
                class="w-20 bg-gray-50 dark:bg-[#050814] border border-gray-300 dark:border-gray-700 rounded-lg px-2 py-1 text-xs sm:text-sm"
              />
            </div>
          </div>
        </div>

        <div class="overflow-x-auto border border-gray-200/70 dark:border-gray-700 rounded-xl">
          <table class="min-w-full text-xs sm:text-sm">
            <thead class="bg-gray-100 dark:bg-[#0b1220] text-gray-700 dark:text-gray-300">
              <tr>
                <th class="px-4 py-2 text-left">Reviewer</th>
                <th class="px-4 py-2 text-left">Avg Rating</th>
                <th class="px-4 py-2 text-left">Reviews</th>
                <th class="px-4 py-2 text-left">Products Reviewed</th>
              </tr>
            </thead>
            <tbody id="userTbody" class="divide-y divide-gray-200/70 dark:divide-gray-700"></tbody>
          </table>
        </div>
      </div>
    </section>

  </main>

  <!-- Existing form scripts -->
  <script type="module" src="../../js/pages/forms/f_googlesheet/index.js"></script>

  <!-- Nav + footer -->
  <script type="module">
    import { loadNav } from "../../js/pageInserts/nav.js";
    import { loadFooter } from "../../js/pageInserts/footer.js";
    loadNav();
    loadFooter();
  </script>
</body>
</html>
